# Telegram 消息监控程序

## 项目简介 
本项目是一个基于 Python 的 Telegram 消息监控程序，利用 `Telethon` 库与 Telegram API 进行交互。程序可以监控指定对话中的消息，根据关键词、正则表达式或文件后缀名进行匹配，自动执行转发、邮件通知等操作。此外，程序还支持定时发送消息等功能。**当匹配到关键词或正则表达式时，程序可将匹配文本记录到用户指定的 `.txt` 文件中**，并默认忽略由本账号自身（程序登录的账号）发送的消息。

## 功能特性 
 
- **关键词监控**：根据指定的关键词或正则表达式，监控特定对话中的消息。
  - 支持完全匹配、关键词匹配和正则表达式匹配。
  - 当检测到匹配的消息时，可选择将消息文本写入由用户指定的 `.txt` 文件。

- **文件监控**：根据指定的文件后缀名（如 `.pdf`、`.docx`）监控特定对话中的文件消息。

- **自动转发**：当检测到匹配的消息时，自动将消息转发到指定的目标对话。

- **邮件通知**：当检测到匹配的消息时，可发送邮件通知。

- **定时消息**：使用 Cron 表达式定时发送消息到指定对话。

- **用户过滤**：可根据用户 ID、用户名或昵称，指定需要监控的用户。

- **日志记录**：记录程序运行过程中的重要事件和错误信息。

- **忽略本账号消息**：程序默认忽略由当前登录账号发送的消息，防止自我循环触发。

## 环境要求 

- Python 3.7 及以上版本
 
- Telegram API 凭证（`api_id` 和 `api_hash`）
 
- 需要安装以下 Python 库： 
  - `telethon`
  - `asyncio`
  - `pytz`
  - `apscheduler`
    
## 安装指南 
 
1. **克隆或下载项目代码**：

```bash
git clone https://github.com/DJKS666/tg-monitor.git

```

1. **安装依赖库**：
```bash
pip install -r requirements.txt

```

如果您使用的是 `pipenv` 或 `conda`，请根据相应的工具安装依赖库。

1. **获取 Telegram API 凭证**：
前往 Telegram 官方网站创建您的应用，获取 `api_id` 和 `api_hash`。
2. **配置邮件服务器（可选）**：
如果您需要使用邮件通知功能，请在代码中配置 SMTP 服务器信息和发件人、收件人邮箱。
```python
SMTP_SERVER = "smtp.qq.com"          # SMTP服务器地址，例如 QQ 邮箱
SMTP_PORT = 465                      # SMTP端口，通常为465
SENDER_EMAIL = "您的邮箱@qq.com"      # 发件人邮箱
EMAIL_PASSWORD = "您的邮箱授权码"      # 邮箱授权码或密码
RECIPIENT_EMAIL = "收件人邮箱@qq.com"  # 收件人邮箱

```

## 使用说明

1. **运行程序**：在终端或命令行中，导航到项目目录，运行以下命令：
```bash
python monitor.py

```

1. **登录 Telegram**：
- 程序首次运行时，会提示您输入 `api_id` 和 `api_hash`。
- 输入您的 Telegram 手机号（格式如 `+8613800138000`），根据提示输入收到的验证码。
- 如果您的账号启用了两步验证，需要输入密码。程序登录后会自动忽略本账号发送的消息。
2. **设置监控参数**：程序启动后，会显示可用命令列表。您可以根据需要添加关键词、文件后缀名监控、全量监控和定时消息等配置。**特别说明**：在添加或修改关键词规则时，程序会询问您是否将匹配到的消息文本记录到指定的 `.txt` 文件中。只需根据提示输入文件名，即可实现消息持久化存储。
3. **启动监控**：在完成配置后，输入命令 `start` 启动监控。程序会根据您设置的规则，监控指定对话中的消息，并对匹配的消息进行相应操作。
## 命令列表

1. **list** - 列出所有对话列出您的 Telegram 账号中的所有对话，包括群组和频道，显示其名称和 ID。
2. **addkeyword** - 添加关键词添加需要监控的关键词或正则表达式，并配置监听的对话、用户过滤、自动转发、邮件通知以及（可选）记录到指定 `.txt` 文件的功能。
3. **modifykeyword** - 修改关键词修改已添加的关键词配置，包括关键词内容、监听对话、用户过滤、自动转发、邮件通知、记录文件设置和匹配类型。
4. **removekeyword** - 移除关键词从关键词监控列表中移除指定关键词。
5. **showkeywords** - 显示所有关键词及其配置列出所有已添加的关键词及对应配置。
6. **addext** - 添加文件后缀名监控添加需要监控的文件后缀名及相关配置（自动转发、邮件通知、用户过滤等）。
7. **modifyext** - 修改文件后缀名监控修改已添加的文件后缀名监控配置。
8. **removeext** - 移除文件后缀名监控从文件监控列表中移除指定后缀名。
9. **showext** - 显示所有文件后缀名及其配置列出当前已添加的文件后缀名及其配置。
10. **schedule** - 添加定时消息使用 Cron 表达式添加定时发送消息的任务。
11. **modifyschedule** - 修改定时消息修改已添加定时消息的目标、内容、Cron 表达式等配置。
12. **removeschedule** - 删除定时消息移除指定的定时消息任务。
13. **showschedule** - 显示所有定时消息显示当前已添加的定时消息及其配置。
14. **addall** - 添加全量监控对指定对话进行全量监控（监听所有消息），可配置用户过滤、自动转发和邮件通知。
15. **modifyall** - 修改全量监控配置修改已添加的全量监控配置。
16. **removeall** - 移除全量监控配置移除指定对话的全量监控配置。
17. **showall** - 显示所有全量监控配置显示当前已配置的全量监控情况。
18. **start** - 开始监控根据已设置的规则开始监听消息。
19. **stop** - 停止监控停止当前的消息监控。
20. **exit** - 退出程序关闭程序并断开与 Telegram 的连接。
## 配置说明

### 关键词监控配置

- **添加关键词**：使用 `addkeyword` 命令添加关键词或正则表达式监控。在配置过程中可选择：匹配类型（完全匹配/关键词匹配/正则匹配）监听的对话 ID用户过滤选项是否自动转发匹配消息是否邮件通知**是否将匹配的消息文本写入指定的 .txt 文件**
- **修改关键词配置**：使用 `modifykeyword` 命令，根据提示修改配置项。
- **移除关键词**：使用 `removekeyword` 命令。
### 文件后缀名监控配置

- **添加文件后缀名监控**：使用 `addext` 命令，根据提示输入文件后缀名、监听对话 ID、用户过滤、自动转发和邮件通知设置。
- **修改文件后缀名配置**：使用 `modifyext` 命令修改相应参数。
- **移除文件后缀名监控**：使用 `removeext` 命令。
### 全量监控配置

- **添加全量监控**：使用 `addall` 命令，对指定对话的所有消息进行监控，并可配置用户过滤、自动转发、邮件通知。
- **修改全量监控**：使用 `modifyall` 命令。
- **移除全量监控**：使用 `removeall` 命令。
- **显示全量监控**：使用 `showall` 命令。
### 定时消息配置

- **添加定时消息**：使用 `schedule` 命令，输入目标对话 ID、消息内容、Cron 表达式、随机延时和发送后删除选项。
- **修改定时消息**：使用 `modifyschedule` 命令。
- **删除定时消息**：使用 `removeschedule` 命令。
- **显示定时消息**：使用 `showschedule` 命令。
## 日志记录

- 程序运行过程中，会将重要事件和错误信息记录到 `telegram_monitor.log` 文件中。
- 日志级别为 `INFO`，包含时间戳、日志级别和消息内容。
- 可通过日志文件了解程序运行状态和调试信息。
## 注意事项

- **Telegram 限制**：请遵守 Telegram 的使用规则，避免过度操作而导致账号限制。
- **安全性**：请妥善保管 `api_id`、`api_hash` 以及 Telegram 会话文件，防止账号信息泄露。
- **邮件配置**：如果需使用邮件通知，请确保 SMTP 服务器和邮箱配置正确。
- **Cron 表达式**：定时任务中的 Cron 表达式需符合标准格式，使用前可进行测试。
## 常见问题

1. **无法连接到 Telegram**：检查网络连接和代理设置，确保访问 Telegram 正常。确保 `api_id`、`api_hash` 输入正确。
2. **收不到邮件通知**：检查邮件配置的 SMTP 信息和邮箱授权码。确认发件人和收件人邮箱地址正确。
3. **自动转发未生效**：确认已正确配置自动转发目标对话 ID。查看日志文件，检查是否有错误信息。
4. **程序异常退出**：查看日志文件查找错误原因。确认 Python 版本和依赖库是否匹配要求。
## 贡献与支持

欢迎对本项目提出建议和改进意见。如果您发现问题或希望新增功能，可在 GitHub 提交 issue 或 pull request。

## 许可证

本项目采用 MIT 许可证。
